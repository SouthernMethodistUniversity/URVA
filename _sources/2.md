# Input description

There are two major types of input that are allowed in the input file.

- Keyword input
- Section input

Besides the input file that can be edited by the users, URVA needs
input data files which record necessary information along the IRC path.

## Input Browsing Data Files

The browsing files are in a compact form generated from any quantum
chemistry package, e.g. Gaussian, that can do a reaction path
calculation (i.e. IRC).

There are currently two types or versions of browsing file. The first
one can be generated with Gaussian.

In Gaussian package, the functionality to generate the first version of
browsing files has been implemented in 09. D and later versions, where
we can specify IOp(1/45D=1000000) to ask the program to dump the URVA
input file.

For the other version, which is a newer version of browsing file, only
COLOGNE program (modified Gaussian links) could generate it by
specifying IOp(1/169=1). \[Please confirm with Niraj Verma for the latest
implementation.\]

An old version of browsing file `IRC.forward` looks like this:

```{include} data/IRC.forward
:literal:
```

This is all browsing information for one point along the reaction path,
a complete browsing file contains many points.

The line starting with `BEGIN` is the starting line for this point.
Followed by a negative floating number which is the reaction
coordinate(parameter) for the current point.

The first column of numbers in `IAnZ` section is the atomic number for
each atoms.

The first number in `NAtom` section is the number of atoms.

The `CC` section is the cartesian coordinates, the unit here is Bohr
instead of Angstrom. It takes the dimension of `3*NAtom`.

The `FX_ZMat_Orientation` section is the Gradient information. It
takes the dimension of `3*NAtom`.

The `FFX_ZMat_Orientation` section is the Hessian(Force constant)
information. It takes the dimension of `3*NAtom*(3*NAtom-1)/2+3*NAtom`
in a lower-triangular form.

The `IPoCou, Energy, XXIRC` section gives the label of points along
the reaction path, electronic structure energy in Hartree and reaction
coordinate(parameter).

A new version of browsing file `for.urv` looks like this:

```{include} data/for.urv
:literal:
```

To distinguish from old browsing file, the first line is
`BEGIN (no Hessian)`, indicating that this browsing file does not
contains Hessian information and is a new browsing file.

The second section of `Natoms,NatomQ` gives the total number of atoms
in the system and number of atoms in the QM part. If the latter is
smaller than the previous, it means this is an QMMM calculation. (in
gaussian, it is an ONIOM calculation.)

The `Atomic mass` section gives all atomic masses for atoms in the
system.

The `CC` section gives the cartesian coordinates information, the unit
here is Bohr instead of Angstrom. It takes the dimension of `3*NAtom`.

The `Tangent` section gives the mass-weighted path direction vector
which has been mass-weighted. It takes the dimension of `3*NAtom`.

The `Curvature` section gives the mass-weighted curvature vector which
has been mass-weighted. It takes the dimension of `3*NAtom`.

The `IPoCou, Energy, XXIRC` section firstly gives the point label
along the reaction path, which can range from a very negative integer to
a very positive integer. The second number is the electronic structure
energy in Hartree. The last number is the reaction coordinate(parameter)
which can range from a very negative floating number to a very positive
floating number.

## Keyword input

Just for convenience, keyword input is often written before section
input. The format of keyword input line is:

`@keyword_name = [keyword_value]`

The `@` symbol should be in the first column. No space is allowed
after it. On both sides of = sign, it should be space. There might be
several optional keyword values available, however, only one option is
accepted.

### `@DATAFILETYPE` keyword

This keywords specifies the format of input data source file for URVA
analysis.

`@DATAFILETYPE = old/new/xyz`

`old`: The input data source file is generated by Gaussian package by
setting corresponding IOp(1/45). This type of data contains most
complete information.

```{note} If the data file is generated by Gaussian with version number
lower than 16.A, all floating numbers should be converted from "D" into
"E" format.
```

`new`: The input data source file is generated by a modified version
of Gaussian package. This type of data has no Hessian and gradient
stored.

`xyz`: XYZ file containing the Cartesian coordinates of multiple
snapshots.

### `@DATAFILEPATH` keyword

This keyword specifies the path of the input data file.

`@DATAFILEPATH = "../path/to/data/file"`

The quotation marks should be included.

### `@ENERGY` keyword

This keyword specifies whether SCF energy and its first and second
derivatives will be calculated.

`@ENERGY = on/off`

### `@PARM` keyword

This keyword specifies the way to deal with internal coordinates
parameters provided by user.

`@PARM = No/GeomOnly/All`

`No`: Do nothing with regard to these internal coordinates
specifications.

`GeomOnly`: Only calculate the value of these internal coordinates.

`All`: Besides the value of internal coordinates, other properties
related to these internal coordinates will be calculated.

### `@VIBRATION` keyword

This keyword specifies whether or not to do normal mode analysis.

`@VIBRATION = on/off`

If the keyword value is set to `on`, the `@DATAFILETYPE` must be set
to `old`.

### `@DIRCURV` keyword

This keyword decides whether or not to calculate reaction path direction
$\boldsymbol {\eta(s)}$ and curvature
$\boldsymbol {\kappa(s)}$.

`@DIRCURV = on/off`

If the keyword value is set to `on`, the `@DATAFILETYPE` must be set
to `old` or `new`.

### `@AVAM` keyword

This keyword specifies whether or not to calculate the adiabatic mode
coupling coefficient $\boldsymbol{ A_{n,s}(s)}$.

`@AVAM = on/off`

If the keyword value is set to `on`, the `@DATAFILETYPE` must be set
to `old`, the `@PARM` must be set to `All`, the `@VIBRATION`
must be set to `on` and the `@DIRCURV` must be set to `on`

### `@CURVCPL` keyword

This keyword specifies whether or not to calculate the curvature
coupling coefficient $\boldsymbol{B_{\mu,s}(s)}$.

`@CURVCPL = on/off`

If the keyword value is set to `on`, the `@DATAFILETYPE` must be set
to `old`, the `@VIBRATION` must be set to `on`, and the
`@DIRCURV` must be set to `on`.

### `@CORIOLIS` keyword

This keyword specifies whether or not to calculate the Coriolis
mode-mode coupling coefficient $\boldsymbol{B_{\mu,\nu}(s)}$.

`@CORIOLIS = on/off`

If the keyword value is set to `on`, the `@DATAFILETYPE` must be set
to `old` and the `@VIBRATION` must be set to `on`.

### `@ADIABFC` keyword

This keyword specifies whether or not to calculate adiabatic force
constant $\mathbf{k^a}$.

`@ADIABFC = on/off`

If the keyword value is set to `on`, the `@DATAFILETYPE` must be set
to `old` and the `@PARM` must be set to `All`.

## Section input

Section input is used when multiple parameters need to be read in, the
format of the section input is:

```
SECTION_NAME
parameter line_1
parameter line_2
...
END SECTION_NAME
```

### `TITLE` section

This section accepts remarks provided by user. The content will be
displayed in standard output.

```
TITLE
Please put remarks here.
Multiple lines are accepted.
END TITLE
```

This section is quite useful to take note of the parameters we use for
URVA calculations.

### `PARAMETER` section

This section contains the internal coordinates specifications provided
by the user. Different types of internal coordinates including ring
coordinates are acceptable.

Bond length, bond angle, dihedral angle, out-of-plane angle,
pyramidalization angle, ring puckering amplitude, ring puckering phase
angle, ring deformation amplitude and ring deformation phase angle are
supported.

```
PARAMETER
Internal coordinate specification
END PARAMETER
```

Bond length:

`std N_1 N_2 : "bond_name"

Bond angle:

`std N_1  N_2  N_3: "angle_name"`

Dihedral angle:

`std N_1  N_2  N_3  N_4 : "dihedral_name" `

Out of plane angle(the angle between the bond length
$N_1$-$N_2$ and the plane
$N_2$-$N_3$-$N_4$):

`oop N_1  N_2  N_3  N_4 : "out_of_plane_name" `

Pyramidalization angle(the angle $\theta_P$ is related to the
three bond angles $N_2$-$N_1$-$N_3$,
$N_3$-$N_1$-$N_4$,
$N_4$-$N_1$-$N_2$):

`pyr N_1  N_2  N_3  N_4 : "pyramidalization_angle_name" `

Radius of planar reference ring($R$)($N_{ring}$: number of
ring atoms):

`ring N_{ring}- (N_1  N_2 ... N_{atoms}) -[0 0]: "ring_breathing_name"`

Planar deformation
amplitude($t_n$)(n=1$\sim$$N_{ring}-2$):

`ring N_{ring}- (N_1  N_2 ... N_{atoms}) -[1 n]: "deformation_amplitude_name"`

Planar deformation phase
angle($\tau_n$)(n=1$\sim$$N_{ring}-2$):

`ring N_{ring}- (N_1  N_2 ... N_{atoms}) -[2 n]: "deformation_phase_angle_name"`

Puckering
amplitude($q_n$)(n=2$\sim$($N_{ring}-1$)/2 for odd
$N_{ring}$ or 2$\sim$$N_{ring}$/2 for even
$N_{ring}$):

`ring N_{ring}- (N_1  N_2 ... N_{atoms}) -[3 n]: "puckering_amplitude_name"`

Puckering phase
angle($\phi_n$)(n=2$\sim$($N_{ring}-1$)/2 for odd
$N_{ring}$ or 2$\sim$$N_{ring}$/2-1 for even
$N_{ring}$):

`ring N_{ring}- (N_1  N_2 ... N_{atoms}) -[4 n]: "puckering_phase_angle_name"`

### `CURVCOR` section

The CURVCOR interface will be activated if this section is found.

For most situations, it is usually enough for $N_l$ and
$N_r$ to take the value of 25.

```
CURVCOR
Ln = $N_l$
Rn = $N_r$
END CURVCOR
```

### `AUTOSMTH` section

The AUTOSMTH interface will be activated if this section is found.

AUTOSMTH interface requires the activation of CURVCOR interface.

$\delta s$ is the stepsize of mass-weighted IRC with the unit of
amu$^{1/2}$-Bohr.

Using the value of 3 is usually enough for $N_l$ and $N_r$.

$t$ is a cut-off for second derivative of smoothened curve.
Increase it when necessary. Recommended value: 2.5.

```
AUTOSMTH
StepSize = $\delta s$
Ln = $N_l$
Rn = $N_r$
d2ythresh = $t$
END AUTOSMTH
```

### `RMSPK` section

The RMSPK interface will be activated if this section is found.

RMSPK interface requires the activation of AUTOSMTH.

Any points in the curvature plot having the value larger than $k$
will be left out as spike.

The value of $p$ ranges from 0.5 to 1.0 as a percentage number.
Any points leading to consecutive difference larger than the percentile
of $p$ will be labeled as spike condidates. Recommened value:
0.85.

Gradient check threshold $g$ is used to filter out normal points
from spike candidates. Recommended value: 1.2.

```
RMSPK
CutHigh = $k$
Percentage = $p$
GradRatio = $g$
END RMSPK
```

### `DMO` section

If this section input is not found, default parameter values will be
used.

$s_{max}$ is an overlap threshold after each mode reordering step.
If the overlap criteria of $s_{max}$ could not be reached, the
criteria will be reduced to $s_{min}$ gradually. Recommend values
for $s_{max}$ and $s_{min}$: 0.990 and 0.890.

If local difficulty is encountered, linear interpolation will be
adopted, space between two consecutive points will be divided into
$N_{min}$ pieces. If the difficulty is still not solved,
$N_{min}$ will be increased up to $N_{max}$. Recommended
values for $N_{min}$ and $N_{max}$: 30 and 200.

If the DMO could not get through for a specific point due to the
following reasons:

- Change of symmetry of reaction complex, e.g. linear
  $\rightarrow$ non-linear
- Discontinuity of reaction path
- Failure of reaction path following close to local minimum region

one solution to circumvent this problem is to calculate and re-order the
vibrational frequencies for a specific region of reaction path. This
function could be activated by setting $IO_{cut}$ to 1. In this
way, the reaction path with its $\mathbf{s}$ value ranging from
$s_{start}$ to $s_{end}$ will have vibrational frequencies
calculated.

In some situations, due to the innate difficulty of path following
algorithm, the DMO might fail at the transition state(TS) point. And
also the first point off TS point in either forward or reverse direction
might also lead to problems. In order to remediate this problem, we can
skip a few points in that region by setting $IO_{skip}$ to 1. If
one point off the TS point in reverse(or forward) direction also needs
to be skipped, $N_{left}$( or $N_{right}$) should be set
to 1.

```
DMO 
Sthresh = $s_{max}$
Slowest = $s_{min}$
Np = $N_{min}$
NMax = $N_{max}$
Cut = $IO_{cut}$
CutA = $s_{start}$
CutB = $s_{end}$
Skip = $IO_{skip}$
SkipA = $N_{left}$
SkipB = $N_{right}$
END DMO
```
